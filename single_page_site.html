<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>A√ßa√≠ Emalluca ‚Äî Delivery</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&display=swap" rel="stylesheet">
  <style>
/* BASE + RESET */
*{box-sizing:border-box;margin:0;padding:0}
html,body{height:100%}
body{
  font-family: 'Inter', sans-serif;
  background: linear-gradient(180deg,#fff7fb 0%, #f6f0ff 100%);
  color:#222;
  -webkit-font-smoothing:antialiased;
}
.container{width:min(1100px,94%);margin:0 auto}

/* HEADER */
.site-header{background:linear-gradient(90deg,#6b1e6b,#a23fa8);color:#fff;padding:14px 0;position:sticky;top:0;z-index:50}
.header-row{display:flex;align-items:center;justify-content:space-between;gap:12px;padding:0 8px}
.brand{font-weight:800;font-size:1.25rem;color:#fff;text-decoration:none}
.header-actions{display:flex;gap:8px;align-items:center}
.icon-btn{background:transparent;border:none;color:#fff;font-size:20px;cursor:pointer}
.cart-btn{background:#fff;color:#6b1e6b;border:none;padding:8px 12px;border-radius:8px;cursor:pointer;font-weight:700}

/* MAIN GRID */
.main-grid{display:grid;grid-template-columns:240px 1fr;gap:18px;padding:20px 0}
.sidebar{padding:12px;background:rgba(255,255,255,0.6);border-radius:12px;height:fit-content;position:sticky;top:76px}
.sidebar nav ul{list-style:none}
.sidebar nav li{padding:10px;border-radius:8px;cursor:pointer;color:#5b2a5b}
.sidebar nav li.active, .sidebar nav li:hover{background:rgba(107,30,107,0.08);font-weight:700}

/* PRODUCTS AREA */
.products-area{min-height:60vh}
.hero{margin-bottom:14px}
.hero h1{color:#4b0d4b;margin-bottom:6px}
.hero p{color:#5d3a5d;margin-bottom:12px}

/* PRODUCT CARD */
.product-card{
  display:flex;gap:16px;background:rgba(255,255,255,0.95);padding:14px;border-radius:12px;
  box-shadow: 0 10px 30px rgba(86,34,86,0.06);align-items:flex-start;margin-bottom:16px;
}
.product-img{width:360px;height:260px;object-fit:cover;border-radius:10px;flex-shrink:0}
.product-main{flex:1;min-width:220px}
.product-main h2{color:#6b1e6b;margin-bottom:6px}
.muted{color:#6b4b6b;margin-bottom:8px}
.step-indicator{font-size:0.95rem;color:#7a5b7a;margin-bottom:8px}

/* steps */
.product-step{display:none}
.product-step.step-active{display:block;margin-bottom:10px}
.product-step h4{margin-bottom:8px}
.product-step label{display:block;padding:6px 8px;border-radius:8px;cursor:pointer;margin-bottom:6px;background:rgba(107,30,107,0.03)}
.product-step input{margin-right:8px}
.comps-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(160px,1fr));gap:8px}

/* buttons */
.btn{display:inline-block;padding:10px 14px;border-radius:10px;border:none;background:#6b1e6b;color:#fff;font-weight:700;cursor:pointer}
.btn.primary{background:#2b9f6b}
.btn.ghost{background:transparent;border:2px solid #6b1e6b;color:#6b1e6b}
.product-actions{margin-top:8px}

/* CART MODAL / PANEL */
.cart-modal{position:fixed;inset:0;display:flex;justify-content:flex-end;visibility:hidden;opacity:0;transition:all .18s;background:rgba(0,0,0,0.35);z-index:90}
.cart-modal[aria-hidden="false"]{visibility:visible;opacity:1}
.cart-panel{width:420px;background:#fff;height:100%;padding:18px;overflow:auto;box-shadow:-10px 0 40px rgba(0,0,0,0.12)}
.close-cart{position:absolute;right:12px;top:12px;background:none;border:none;font-size:22px;cursor:pointer}
.cart-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:8px}
.cart-count-muted{color:#666;font-size:0.95rem}

/* cart items */
.cart-items{margin-top:6px}
.cart-item{display:flex;justify-content:space-between;gap:8px;padding:10px 0;border-bottom:1px solid #eee;align-items:flex-start}
.cart-item .left{max-width:70%}
.cart-item strong{display:block;color:#3b0f3b;margin-bottom:6px}
.cart-item small{display:block;color:#666;font-size:0.92rem;margin-bottom:4px}
.item-controls{display:flex;gap:6px;align-items:center;margin-top:6px}
.qty-btn{padding:6px 8px;border-radius:8px;border:1px solid #ddd;background:#fafafa;cursor:pointer}
.remove-btn{background:transparent;border:none;color:#d9534f;cursor:pointer}

/* total + delivery */
.cart-summary{margin-top:12px}
.total-row{display:flex;justify-content:space-between;align-items:center;font-weight:800;font-size:1.05rem;margin-bottom:10px}
.delivery-section{margin-top:8px}
.delivery-section label{display:block;margin:6px 0;cursor:pointer}
.address-block{margin-top:8px}
.address-block input{width:100%;padding:10px;border-radius:8px;border:1px solid #ddd}

/* cart actions */
.cart-actions{display:flex;gap:10px;margin-top:12px}
.cart-actions .btn{flex:1}

/* FOOTER + MOBILE CART BAR */
.site-footer{background:linear-gradient(90deg,#6b1e6b,#a23fa8);color:#fff;padding:14px 0;margin-top:20px}
.footer-inner{display:flex;justify-content:space-between;align-items:center}

/* mobile cart fixed bar */
.mobile-cart-bar{position:fixed;left:12px;right:12px;bottom:12px;background:#fff;border-radius:12px;box-shadow:0 14px 30px rgba(0,0,0,0.12);display:flex;justify-content:space-between;align-items:center;padding:10px 12px;gap:8px;z-index:80}
.mobile-cart-left{display:flex;gap:10px;align-items:center}
.cart-footer-btn{background:transparent;border:none;font-size:18px;cursor:pointer}
.mobile-total{font-weight:800}
.mobile-cart-right .btn{padding:10px 16px;border-radius:8px}

/* RESPONSIVE */
@media (max-width: 900px){
  .main-grid{grid-template-columns:1fr; padding-bottom:90px;}
  .sidebar{display:none}
  .product-img{width:100%;height:220px;border-radius:10px}
  .product-card{flex-direction:column;align-items:flex-start}
  .cart-panel{width:100%}
}
</style>
</head>
<body>

<header class="site-header">
  <div class="container header-row">
    <a class="brand" href="#">A√ßa√≠ Emalluca</a>
    <div class="header-actions">
      <button id="openCategories" class="icon-btn">‚ò∞</button>
      <button id="cartMobileBtn" class="cart-btn">üõí <span id="cart-count">0</span></button>
    </div>
  </div>
</header>

<main class="container main-grid">

  <!-- Sidebar / categories (mobile collapsible) -->
  <aside class="sidebar" id="sidebar">
    <nav>
      <ul>
        <li class="cat active" data-filter="all">Todos</li>
        <li class="cat" data-filter="trufado">Trufado</li>
        <li class="cat" data-filter="pote">Pote</li>
        <li class="cat" data-filter="isopor">Isopor</li>
        <li class="cat" data-filter="roleta">Roleta</li>
      </ul>
    </nav>
  </aside>

  <!-- Products area -->
  <section class="products-area" id="productsArea">
    <header class="hero">
      <h1>Pe√ßa seu A√ßa√≠</h1>
      <p>Escolha o produto, personalize e finalize pelo WhatsApp ‚Äî r√°pido e simples.</p>
    </header>

    <!-- PRODUCT: A√ßa√≠ Trufado -->
    <article class="product-card" data-category="trufado" data-name="A√ßa√≠ Trufado">
      <img class="product-img" src="https://dompapito.seumenudigital.com.br/wp-content/uploads/2021/06/ACAI-TRUFADO.jpeg?text=A√ßa√≠+Trufado" alt="A√ßa√≠ Trufado">
      <div class="product-main">
        <h2>A√ßa√≠ Trufado</h2>
        <p class="muted">Trufado ‚Äî escolha creme, massa e complementos.</p>
        <div class="step-indicator">Passo <span class="current-step">1</span> de 4</div>

        <div class="product-step step-active" data-step="1">
          <h4>1) Tamanho</h4>
          <label><input type="radio" name="trufado-tamanho" value="300ml" data-price="21.99"> 300ml ‚Äî R$ 21,99</label>
          <label><input type="radio" name="trufado-tamanho" value="400ml" data-price="25.99"> 400ml ‚Äî R$ 25,99</label>
          <label><input type="radio" name="trufado-tamanho" value="500ml" data-price="28.99"> 500ml ‚Äî R$ 28,99</label>
          <label><input type="radio" name="trufado-tamanho" value="700ml" data-price="34.99"> 700ml ‚Äî R$ 34,99</label>
          <button class="btn next-step">Pr√≥ximo</button>
        </div>

        <div class="product-step" data-step="2">
          <h4>2) Creme</h4>
          <label><input type="radio" name="trufado-creme" value="Avel√£"> Avel√£</label>
          <label><input type="radio" name="trufado-creme" value="Ninho"> Ninho</label>
          <label><input type="radio" name="trufado-creme" value="Pa√ßoca"> Pa√ßoca</label>
          <button class="btn next-step">Pr√≥ximo</button>
        </div>

        <div class="product-step" data-step="3">
          <h4>3) Massa</h4>
          <label><input type="radio" name="trufado-massa" value="A√ßa√≠"> A√ßa√≠</label>
          <label><input type="radio" name="trufado-massa" value="Cupua√ßu"> Cupua√ßu</label>
          <button class="btn next-step">Pr√≥ximo</button>
        </div>

        <div class="product-step" data-step="4">
          <h4>4) Complementos</h4>
          <div class="comps-grid">
            <label><input type="checkbox" name="trufado-complementos" value="Leite em p√≥"> Leite em p√≥</label>
            <label><input type="checkbox" name="trufado-complementos" value="Leite condensado"> Leite condensado</label>
            <label><input type="checkbox" name="trufado-complementos" value="Sucrilhos"> Sucrilhos</label>
            <label><input type="checkbox" name="trufado-complementos" value="Pa√ßoca"> Pa√ßoca</label>
            <label><input type="checkbox" name="trufado-complementos" value="Granola"> Granola</label>
            <label><input type="checkbox" name="trufado-complementos" value="Banana"> Banana</label>
            <label><input type="checkbox" name="trufado-complementos" value="Uva"> Uva</label>
            <label><input type="checkbox" name="trufado-complementos" value="Morango"> Morango</label>
          </div>
          <div class="product-actions">
            <button class="btn add-to-cart" data-product="A√ßa√≠ Trufado">Adicionar ao carrinho</button>
          </div>
        </div>
      </div>
    </article>

    <!-- PRODUCT: A√ßa√≠ de Pote -->
    <article class="product-card" data-category="pote" data-name="A√ßa√≠ de Pote">
      <img class="product-img" src="https://saopotinho.com.br/img/assets/Foto-Header.png?text=A√ßa√≠+de+Pote" alt="A√ßa√≠ de Pote">
      <div class="product-main">
        <h2>A√ßa√≠ de Pote</h2>
        <p class="muted">Pr√°tico para viagem ‚Äî massa + complementos (sem creme).</p>
        <div class="step-indicator">Passo <span class="current-step">1</span> de 3</div>

        <div class="product-step step-active" data-step="1">
          <h4>1) Tamanho</h4>
          <label><input type="radio" name="pote-tamanho" value="200ml" data-price="12.99"> 200ml ‚Äî R$12,99</label>
          <label><input type="radio" name="pote-tamanho" value="250ml" data-price="14.99"> 250ml ‚Äî R$14,99</label>
          <label><input type="radio" name="pote-tamanho" value="300ml" data-price="16.99"> 300ml ‚Äî R$16,99</label>
          <label><input type="radio" name="pote-tamanho" value="350ml" data-price="18.99"> 350ml ‚Äî R$18,99</label>
          <label><input type="radio" name="pote-tamanho" value="360ml" data-price="22.99"> 360ml ‚Äî R$22,99</label>
          <label><input type="radio" name="pote-tamanho" value="473ml" data-price="26.99"> 473ml ‚Äî R$26,99</label>
          <label><input type="radio" name="pote-tamanho" value="500ml" data-price="29.99"> 500ml ‚Äî R$29,99</label>
          <label><input type="radio" name="pote-tamanho" value="750ml" data-price="34.99"> 750ml ‚Äî R$34,99</label>
          <label><input type="radio" name="pote-tamanho" value="1L" data-price="42.99"> 1L ‚Äî R$42,99</label>
          <button class="btn next-step">Pr√≥ximo</button>
        </div>

        <div class="product-step" data-step="2">
          <h4>2) Massa</h4>
          <label><input type="radio" name="pote-massa" value="A√ßa√≠"> A√ßa√≠</label>
          <label><input type="radio" name="pote-massa" value="Cupua√ßu"> Cupua√ßu</label>
          <button class="btn next-step">Pr√≥ximo</button>
        </div>

        <div class="product-step" data-step="3">
          <h4>3) Complementos</h4>
          <div class="comps-grid">
            <label><input type="checkbox" name="pote-complementos" value="Leite em p√≥"> Leite em p√≥</label>
            <label><input type="checkbox" name="pote-complementos" value="Leite condensado"> Leite condensado</label>
            <label><input type="checkbox" name="pote-complementos" value="Sucrilhos"> Sucrilhos</label>
            <label><input type="checkbox" name="pote-complementos" value="Pa√ßoca"> Pa√ßoca</label>
            <label><input type="checkbox" name="pote-complementos" value="Granola"> Granola</label>
            <label><input type="checkbox" name="pote-complementos" value="Banana"> Banana</label>
            <label><input type="checkbox" name="pote-complementos" value="Uva"> Uva</label>
            <label><input type="checkbox" name="pote-complementos" value="Morango"> Morango</label>
          </div>
          <div class="product-actions">
            <button class="btn add-to-cart" data-product="A√ßa√≠ de Pote">Adicionar ao carrinho</button>
          </div>
        </div>
      </div>
    </article>

    <!-- PRODUCT: A√ßa√≠ no Isopor -->
    <article class="product-card" data-category="isopor" data-name="A√ßa√≠ no Isopor">
      <img class="product-img" src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcSabqodxUu991g4PJfPYtsIcajY8On62MgJnA&s?text=A√ßa√≠+no+Isopor" alt="A√ßa√≠ no Isopor">
      <div class="product-main">
        <h2>A√ßa√≠ no Isopor</h2>
        <p class="muted">Perfeito para festas ‚Äî massa + complementos (sem creme).</p>
        <div class="step-indicator">Passo <span class="current-step">1</span> de 3</div>

        <div class="product-step step-active" data-step="1">
          <h4>1) Tamanho</h4>
          <label><input type="radio" name="isopor-tamanho" value="P" data-price="21.99"> P ‚Äî R$21,99</label>
          <label><input type="radio" name="isopor-tamanho" value="G" data-price="27.99"> G ‚Äî R$27,99</label>
          <button class="btn next-step">Pr√≥ximo</button>
        </div>

        <div class="product-step" data-step="2">
          <h4>2) Massa</h4>
          <label><input type="radio" name="isopor-massa" value="A√ßa√≠"> A√ßa√≠</label>
          <label><input type="radio" name="isopor-massa" value="Cupua√ßu"> Cupua√ßu</label>
          <button class="btn next-step">Pr√≥ximo</button>
        </div>

        <div class="product-step" data-step="3">
          <h4>3) Complementos</h4>
          <div class="comps-grid">
            <label><input type="checkbox" name="isopor-complementos" value="Leite em p√≥"> Leite em p√≥</label>
            <label><input type="checkbox" name="isopor-complementos" value="Leite condensado"> Leite condensado</label>
            <label><input type="checkbox" name="isopor-complementos" value="Sucrilhos"> Sucrilhos</label>
            <label><input type="checkbox" name="isopor-complementos" value="Pa√ßoca"> Pa√ßoca</label>
            <label><input type="checkbox" name="isopor-complementos" value="Granola"> Granola</label>
            <label><input type="checkbox" name="isopor-complementos" value="Banana"> Banana</label>
            <label><input type="checkbox" name="isopor-complementos" value="Uva"> Uva</label>
            <label><input type="checkbox" name="isopor-complementos" value="Morango"> Morango</label>
          </div>
          <div class="product-actions">
            <button class="btn add-to-cart" data-product="A√ßa√≠ no Isopor">Adicionar ao carrinho</button>
          </div>
        </div>
      </div>
    </article>

    <!-- PRODUCT: Roleta de A√ßa√≠ -->
    <article class="product-card" data-category="roleta" data-name="Roleta de A√ßa√≠">
      <img class="product-img" src="https://images.githubassets.top/roleta-acai-png.jpg?text=Roleta+de+A√ßa√≠" alt="Roleta de A√ßa√≠">
      <div class="product-main">
        <h2>Roleta de A√ßa√≠</h2>
        <p class="muted">Roleta ‚Äî divers√£o e sabor, massa + complementos (sem creme).</p>
        <div class="step-indicator">Passo <span class="current-step">1</span> de 3</div>

        <div class="product-step step-active" data-step="1">
          <h4>1) Tamanho</h4>
          <label><input type="radio" name="roleta-tamanho" value="P" data-price="29.99"> P ‚Äî R$29,99</label>
          <label><input type="radio" name="roleta-tamanho" value="G" data-price="49.99"> G ‚Äî R$49,99</label>
          <button class="btn next-step">Pr√≥ximo</button>
        </div>

        <div class="product-step" data-step="2">
          <h4>2) Massa</h4>
          <label><input type="radio" name="roleta-massa" value="A√ßa√≠"> A√ßa√≠</label>
          <label><input type="radio" name="roleta-massa" value="Cupua√ßu"> Cupua√ßu</label>
          <button class="btn next-step">Pr√≥ximo</button>
        </div>

        <div class="product-step" data-step="3">
          <h4>3) Complementos</h4>
          <div class="comps-grid">
            <label><input type="checkbox" name="roleta-complementos" value="Leite em p√≥"> Leite em p√≥</label>
            <label><input type="checkbox" name="roleta-complementos" value="Leite condensado"> Leite condensado</label>
            <label><input type="checkbox" name="roleta-complementos" value="Sucrilhos"> Sucrilhos</label>
            <label><input type="checkbox" name="roleta-complementos" value="Pa√ßoca"> Pa√ßoca</label>
            <label><input type="checkbox" name="roleta-complementos" value="Granola"> Granola</label>
            <label><input type="checkbox" name="roleta-complementos" value="Banana"> Banana</label>
            <label><input type="checkbox" name="roleta-complementos" value="Uva"> Uva</label>
            <label><input type="checkbox" name="roleta-complementos" value="Morango"> Morango</label>
          </div>
          <div class="product-actions">
            <button class="btn add-to-cart" data-product="Roleta de A√ßa√≠">Adicionar ao carrinho</button>
          </div>
        </div>
      </div>
    </article>

  </section>
</main>

<!-- Cart modal / side panel -->
<div id="cartModal" class="cart-modal" aria-hidden="true">
  <div class="cart-panel">
    <button id="closeCart" class="close-cart">‚úï</button>
    <div class="cart-header">
      <h3>Seu pedido</h3>
      <div class="cart-count-muted"><span id="cart-count-2">0</span> itens</div>
    </div>

    <div id="cartItems" class="cart-items"></div>

    <div class="cart-summary">
      <div class="total-row">
        <div>Total</div>
        <div id="cartTotal">R$ 0,00</div>
      </div>

      <div class="delivery-section">
        <label><input type="radio" name="deliveryType" value="Retirada" checked> Retirada no balc√£o</label>
        <label><input type="radio" name="deliveryType" value="Entrega"> Entrega</label>

        <div id="addressBlock" class="address-block" style="display:none;">
          <input id="deliveryAddress" type="text" placeholder="Endere√ßo (Rua, n¬∫, complemento...)">
        </div>
      </div>

      <div class="cart-actions">
        <button id="clearCart" class="btn ghost">Limpar</button>
        <button id="finishOrder" class="btn primary">Finalizar Pedido</button>
      </div>
    </div>
  </div>
</div>

<!-- Footer + mobile fixed cart bar -->
<footer class="site-footer">
  <div class="container footer-inner">
    <div>¬© <span id="year"></span> A√ßa√≠ Emalluca</div>
    <div class="footer-right">Feito com ‚ô•</div>
  </div>
</footer>

<nav class="mobile-cart-bar" id="mobileCartBar">
  <div class="mobile-cart-left">
    <button id="openCartFooter" class="cart-footer-btn">üõí <span id="cart-count-footer">0</span></button>
    <div class="mobile-total" id="mobileTotal">R$ 0,00</div>
  </div>
  <div class="mobile-cart-right">
    <button id="quickCheckout" class="btn primary">Finalizar</button>
  </div>
</nav>

<script>
// ========= script.js =========

// ----- Config -----
let cart = [];
const whatsappNumber = "5511951247812"; // <-- coloque seu n√∫mero aqui (ex: 5511999999999)

// set footer year
const yearEl = document.getElementById('year');
if(yearEl) yearEl.textContent = new Date().getFullYear();

// util: format BR
function formatBR(num){
  // calcular d√≠gito por d√≠gito implicitly via toFixed then replace
  return 'R$ ' + Number(num).toFixed(2).replace('.',',');
}

// ---------- PRODUCT: passos e adicionar ----------
document.querySelectorAll('.product-card').forEach(card => {
  const steps = Array.from(card.querySelectorAll('.product-step'));
  const indicator = card.querySelector('.current-step');
  let current = 0;
  if(steps[current]) steps[current].classList.add('step-active');

  // next-step buttons
  card.querySelectorAll('.next-step').forEach(btn => {
    btn.addEventListener('click', () => {
      // validate if radio options present in current step
      const radios = steps[current].querySelectorAll('input[type="radio"]');
      if(radios.length > 0){
        let ok = false;
        radios.forEach(r => { if(r.checked) ok = true; });
        if(!ok){ alert('Selecione uma op√ß√£o antes de continuar.'); return; }
      }

      steps[current].classList.remove('step-active');
      current++;
      if(current >= steps.length) current = steps.length - 1;
      steps[current].classList.add('step-active');
      if(indicator) indicator.textContent = (current + 1);
    });
  });

  // add to cart buttons
  card.querySelectorAll('.add-to-cart').forEach(btn => {
    btn.addEventListener('click', () => {
      // get chosen size (name ends with "tamanho")
      const sizeEl = card.querySelector('input[name$="tamanho"]:checked');
      if(!sizeEl){
        alert('Escolha um tamanho antes de adicionar.');
        return;
      }
      const cremeEl = card.querySelector('input[name$="creme"]:checked');
      const massaEl = card.querySelector('input[name$="massa"]:checked');
      const complements = Array.from(card.querySelectorAll('input[type="checkbox"]:checked')).map(i => i.value);

      const item = {
        productName: card.dataset.name,
        name: card.dataset.name + ' ' + sizeEl.value,
        size: sizeEl.value,
        creme: cremeEl ? cremeEl.value : null,
        massa: massaEl ? massaEl.value : null,
        complementos: complements,
        price: parseFloat(sizeEl.dataset.price),
        qty: 1
      };

      cart.push(item);
      alert('Adicionado ao carrinho!');
      // reset product UI
      steps.forEach(s => s.classList.remove('step-active'));
      current = 0;
      if(steps[current]) steps[current].classList.add('step-active');
      if(indicator) indicator.textContent = (current + 1);
      card.querySelectorAll('input').forEach(i => i.checked = false);
      updateCartUI();
    });
  });
});

// ---------- CART UI (render, remove, qty) ----------
function updateCartUI(){
  const cartItemsEl = document.getElementById('cartItems');
  const cartCountEls = [
    document.getElementById('cart-count'),
    document.getElementById('cart-count-2'),
    document.getElementById('cart-count-footer')
  ];
  const cartTotalEl = document.getElementById('cartTotal');
  const mobileTotalEl = document.getElementById('mobileTotal');

  if(!cartItemsEl) return;
  cartItemsEl.innerHTML = '';

  let total = 0;
  cart.forEach((it, idx) => {
    total += it.price * it.qty;

    const itemDiv = document.createElement('div');
    itemDiv.className = 'cart-item';

    const comps = (it.complementos && it.complementos.length) ? it.complementos.join(', ') : '-';
    itemDiv.innerHTML = `
      <div class="left">
        <strong>${it.name}</strong>
        <small>Creme: ${it.creme || '-'}</small>
        <small>Massa: ${it.massa || '-'}</small>
        <small>Complementos: ${comps}</small>

        <div class="item-controls">
          <button class="qty-btn" data-action="minus" data-idx="${idx}">‚àí</button>
          <div style="min-width:28px;text-align:center">${it.qty}</div>
          <button class="qty-btn" data-action="plus" data-idx="${idx}">+</button>
          <button class="remove-btn" data-idx="${idx}">Remover</button>
        </div>
      </div>
      <div class="right">
        <div>${formatBR(it.price * it.qty)}</div>
      </div>
    `;

    cartItemsEl.appendChild(itemDiv);
  });

  // update counts
  const count = cart.reduce((s, i) => s + i.qty, 0);
  cartCountEls.forEach(el => { if(el) el.textContent = count; });

  // update totals
  if(cartTotalEl) cartTotalEl.textContent = formatBR(total);
  if(mobileTotalEl) mobileTotalEl.textContent = formatBR(total);

  // attach listeners for qty and remove
  cartItemsEl.querySelectorAll('.qty-btn').forEach(b => {
    b.addEventListener('click', (e) => {
      const idx = Number(b.dataset.idx);
      const action = b.dataset.action;
      if(action === 'plus') cart[idx].qty += 1;
      else cart[idx].qty = Math.max(1, cart[idx].qty - 1);
      updateCartUI();
    });
  });
  cartItemsEl.querySelectorAll('.remove-btn').forEach(b => {
    b.addEventListener('click', () => {
      const idx = Number(b.dataset.idx);
      if(confirm('Remover este item?')){
        cart.splice(idx, 1);
        updateCartUI();
      }
    });
  });

  // update mobile cart button totals
  const cartCountFooter = document.getElementById('cart-count-footer');
  if(cartCountFooter) cartCountFooter.textContent = count;
}

// ---------- CART modal open/close & shortcuts ----------
const cartModal = document.getElementById('cartModal');
const cartBtn = document.getElementById('cartMobileBtn');
const openCartFooter = document.getElementById('openCartFooter');
const closeCartBtn = document.getElementById('closeCart');
const quickCheckout = document.getElementById('quickCheckout');
const cartMobileBtnMain = document.getElementById('cartMobileBtn');

if(cartBtn){
  cartBtn.addEventListener('click', () => cartModal.setAttribute('aria-hidden','false'));
}
if(closeCartBtn){
  closeCartBtn.addEventListener('click', () => cartModal.setAttribute('aria-hidden','true'));
}
if(openCartFooter){
  openCartFooter.addEventListener('click', () => cartModal.setAttribute('aria-hidden','false'));
}
if(cartMobileBtnMain){
  cartMobileBtnMain.addEventListener('click', () => cartModal.setAttribute('aria-hidden','false'));
}
if(quickCheckout){
  quickCheckout.addEventListener('click', () => {
    cartModal.setAttribute('aria-hidden','false');
    // focus address maybe
    const addr = document.getElementById('deliveryAddress');
    if(addr) addr.focus();
  });
}

// CLEAR CART
const clearCartBtn = document.getElementById('clearCart');
if(clearCartBtn){
  clearCartBtn.addEventListener('click', () => {
    if(confirm('Deseja limpar o carrinho?')){
      cart = [];
      updateCartUI();
    }
  });
}

// ---------- Delivery radio logic ----------
const deliveryRadios = document.querySelectorAll('input[name="deliveryType"]');
const addressBlock = document.getElementById('addressBlock');
const addressInput = document.getElementById('deliveryAddress');

deliveryRadios.forEach(r => {
  r.addEventListener('change', () => {
    if(r.value === 'Entrega' && r.checked){
      addressBlock.style.display = 'block';
      if(addressInput) addressInput.focus();
    } else if(r.value === 'Retirada' && r.checked){
      addressBlock.style.display = 'none';
    }
  });
});

// ---------- Categories (filter) ----------
document.querySelectorAll('.cat').forEach(li => {
  li.addEventListener('click', () => {
    document.querySelectorAll('.cat').forEach(x => x.classList.remove('active'));
    li.classList.add('active');
    const filter = li.dataset.filter;
    document.querySelectorAll('.product-card').forEach(card => {
      if(filter === 'all') card.style.display = '';
      else card.style.display = (card.dataset.category === filter) ? '' : 'none';
    });
    // hide sidebar on mobile
    const sidebar = document.getElementById('sidebar');
    if(window.innerWidth < 900 && sidebar) sidebar.style.display = 'none';
  });
});

// open/close sidebar for mobile
const openCategories = document.getElementById('openCategories');
if(openCategories){
  openCategories.addEventListener('click', () => {
    const side = document.getElementById('sidebar');
    if(side) side.style.display = (side.style.display === 'block') ? 'none' : 'block';
  });
}

// ---------- Finalize order: WhatsApp message ----------
const finishOrderBtn = document.getElementById('finishOrder');
if(finishOrderBtn){
  finishOrderBtn.addEventListener('click', () => {
    if(cart.length === 0){
      alert('Carrinho vazio. Adicione algum produto antes de finalizar.');
      return;
    }
    const deliveryTypeEl = document.querySelector('input[name="deliveryType"]:checked');
    const deliveryType = deliveryTypeEl ? deliveryTypeEl.value : 'Retirada';
    const address = addressInput ? addressInput.value.trim() : '';

    if(deliveryType === 'Entrega' && (!address || address.length < 5)){
      alert('Por favor preencha o endere√ßo completo para entrega.');
      if(addressInput) addressInput.focus();finishOrderBtn.addEventListener('click', () => {
  if(cart.length === 0){
    alert('Carrinho vazio. Adicione algum produto antes de finalizar.');
    return;
  }
  const deliveryTypeEl = document.querySelector('input[name="deliveryType"]:checked');
  const deliveryType = deliveryTypeEl ? deliveryTypeEl.value : 'Retirada';
  const address = addressInput ? addressInput.value.trim() : '';

  if(deliveryType === 'Entrega' && (!address || address.length < 5)){
    alert('Por favor preencha o endere√ßo completo para entrega.');
    if(addressInput) addressInput.focus();
    return;
  }

  // Monta objeto para salvar no Firestore
  const pedido = {
    itens: cart,
    total: cart.reduce((sum, it) => sum + it.price * it.qty, 0),
    tipoEntrega: deliveryType,
    endereco: address || null,
    criadoEm: new Date()
  };

  // Salva no Firestore
  db.collection('pedidos').add(pedido)
    .then(() => console.log("Pedido salvo com sucesso!"))
    .catch(err => console.error("Erro ao salvar pedido:", err));

  // --- continua com o c√≥digo do WhatsApp que voc√™s j√° t√™m ---
  let message = `Ol√°, gostaria de fazer um pedido:%0A%0A`;
  let total = 0;
  cart.forEach((it, idx) => {
    message += `${idx+1}. ${it.productName} - ${it.size}%0A`;
    if(it.creme) message += `   Creme: ${it.creme}%0A`;
    if(it.massa) message += `   Massa: ${it.massa}%0A`;
    if(it.complementos && it.complementos.length) message += `   Complementos: ${it.complementos.join(', ')}%0A`;
    message += `   Quantidade: ${it.qty}%0A`;
    message += `   Valor: R$ ${(it.price * it.qty).toFixed(2).replace('.', ',')}%0A%0A`;
    total += it.price * it.qty;
  });
  message += `Total: R$ ${total.toFixed(2).replace('.', ',')}%0A`;
  message += `Op√ß√£o: ${deliveryType}%0A`;
  if(deliveryType === 'Entrega') message += `Endere√ßo: ${encodeURIComponent(address)}%0A`;
  message += `%0AObrigado!`;

  const url = `https://wa.me/5511951247812?text=${message}`;
  window.open(url, '_blank');
});

      return;
    }

    // build message
    let message = `Ol√°, gostaria de fazer um pedido:%0A%0A`; // using URL-encoded newline
    let total = 0;
    cart.forEach((it, idx) => {
      message += `${idx+1}. ${it.productName} - ${it.size}%0A`;
      if(it.creme) message += `   Creme: ${it.creme}%0A`;
      if(it.massa) message += `   Massa: ${it.massa}%0A`;
      if(it.complementos && it.complementos.length) message += `   Complementos: ${it.complementos.join(', ')}%0A`;
      message += `   Quantidade: ${it.qty}%0A`;
      message += `   Valor: ${formatBR(it.price * it.qty)}%0A%0A`;
      total += it.price * it.qty;
    });
    message += `Total: ${formatBR(total)}%0A`;
    message += `Op√ß√£o: ${deliveryType}%0A`;
    if(deliveryType === 'Entrega') message += `Endere√ßo: ${encodeURIComponent(address)}%0A`;
    message += `%0AObrigado!`;

    const url = `https://wa.me/${+5511951247812}?text=${message}`;
    window.open(url, '_blank');
  });
}

// initialize UI counts
updateCartUI();
</script>
</body>
</html>